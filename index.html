<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micopel - Sistema de Concorr√™ncia</title>
    
    <!-- Favicon corrigido -->
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMgpEeAABpoAABVgX2VAAAAABJRU5ErkJggg==">
    <link rel="shortcut icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMgpEeAABpoAABVgX2VAAAAABJRU5ErkJggg==">
    
    <!-- CSS -->
    <style>
        /* CSS integrado para evitar erros de carregamento */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        #app {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #e0e0e0;
        }

        .chart-error {
            text-align: center;
            color: #666;
            padding: 40px;
        }

        .chart-error p {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .chart-error small {
            color: #999;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        #status {
            margin-top: 20px;
            padding: 20px;
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 10px;
            color: #2e7d32;
            text-align: center;
            font-weight: bold;
        }

        .status-warning {
            background: #fff3e0 !important;
            border-color: #ff9800 !important;
            color: #e65100 !important;
        }

        .status-error {
            background: #ffebee !important;
            border-color: #f44336 !important;
            color: #c62828 !important;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <div id="app">
        <header>
            <h1>üöÄ Micopel Concorr√™ncia</h1>
            <p class="subtitle">Sistema de Gest√£o e An√°lise de Concorr√™ncia</p>
        </header>

        <div class="dashboard">
            <div class="card">
                <h2>üìä Gr√°fico de Desempenho</h2>
                <div id="chart-container" class="chart-container">
                    <div class="chart-error">
                        <p>‚è≥ Carregando gr√°fico...</p>
                    </div>
                </div>
                <div class="controls">
                    <button onclick="app.updateChart('week')">Semana</button>
                    <button onclick="app.updateChart('month')">M√™s</button>
                    <button onclick="app.updateChart('year')">Ano</button>
                </div>
            </div>

            <div class="card">
                <h2>üìà M√©tricas Principais</h2>
                <div class="metrics">
                    <div class="metric-card">
                        <div class="metric-label">Market Share</div>
                        <div class="metric-value" id="metric-1">24.5%</div>
                        <small>+2.1% vs anterior</small>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Crescimento</div>
                        <div class="metric-value" id="metric-2">15.8%</div>
                        <small>Trimestral</small>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Clientes</div>
                        <div class="metric-value" id="metric-3">1,247</div>
                        <small>Ativos</small>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Satisfa√ß√£o</div>
                        <div class="metric-value" id="metric-4">94%</div>
                        <small>NPS Score</small>
                    </div>
                </div>
            </div>
        </div>

        <div id="status">‚úÖ Aplica√ß√£o Micopel Concorr√™ncia Inicializada!</div>
    </div>

    <!-- Scripts integrados para evitar erros 404 -->
    <script>
        // =============================================
        // scplot.js - Biblioteca de Gr√°ficos Corrigida
        // =============================================
        const scplot = (function() {
            'use strict';
            
            const library = {
                version: '2.1.0',
                charts: new Map(),
                
                createChart: function(config) {
                    try {
                        console.log('üìà Inicializando scplot chart...');
                        
                        const container = typeof config.container === 'string' 
                            ? document.querySelector(config.container) 
                            : config.container;
                            
                        if (!container) {
                            throw new Error('Container n√£o encontrado: ' + config.container);
                        }
                        
                        // Limpa container
                        container.innerHTML = '';
                        
                        // Cria canvas
                        const canvas = document.createElement('canvas');
                        canvas.width = container.clientWidth - 40;
                        canvas.height = 250;
                        canvas.style.maxWidth = '100%';
                        container.appendChild(canvas);
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Dados padr√£o se n√£o fornecidos
                        const data = config.data || this.generateSampleData();
                        const options = config.options || {};
                        
                        // Renderiza gr√°fico
                        this.renderChart(ctx, canvas.width, canvas.height, data, options);
                        
                        const chartId = 'chart_' + Date.now();
                        this.charts.set(chartId, {
                            canvas: canvas,
                            ctx: ctx,
                            data: data,
                            options: options
                        });
                        
                        console.log('‚úÖ Gr√°fico scplot criado com sucesso');
                        return chartId;
                        
                    } catch (error) {
                        console.error('‚ùå Erro ao criar gr√°fico scplot:', error);
                        this.handleError(config.container, error);
                        return null;
                    }
                },
                
                renderChart: function(ctx, width, height, data, options) {
                    try {
                        // Limpa canvas
                        ctx.clearRect(0, 0, width, height);
                        
                        // Configura√ß√µes
                        const padding = 40;
                        const chartWidth = width - 2 * padding;
                        const chartHeight = height - 2 * padding;
                        
                        // Encontra valores m√°ximo e m√≠nimo
                        const allValues = data.series.flatMap(series => series.data);
                        const maxValue = Math.max(...allValues) * 1.1;
                        const minValue = Math.min(0, Math.min(...allValues));
                        
                        // Desenha eixo Y
                        ctx.beginPath();
                        ctx.moveTo(padding, padding);
                        ctx.lineTo(padding, height - padding);
                        ctx.strokeStyle = '#ccc';
                        ctx.stroke();
                        
                        // Desenha eixo X
                        ctx.beginPath();
                        ctx.moveTo(padding, height - padding);
                        ctx.lineTo(width - padding, height - padding);
                        ctx.strokeStyle = '#ccc';
                        ctx.stroke();
                        
                        // Desenha grades
                        ctx.strokeStyle = '#f0f0f0';
                        for (let i = 0; i <= 5; i++) {
                            const y = padding + (chartHeight / 5) * i;
                            ctx.beginPath();
                            ctx.moveTo(padding, y);
                            ctx.lineTo(width - padding, y);
                            ctx.stroke();
                        }
                        
                        // Desenha s√©ries
                        const colors = ['#667eea', '#764ba2', '#f093fb', '#4facfe'];
                        const barWidth = chartWidth / (data.categories.length * data.series.length) * 0.8;
                        
                        data.series.forEach((series, seriesIndex) => {
                            ctx.fillStyle = colors[seriesIndex % colors.length];
                            
                            series.data.forEach((value, dataIndex) => {
                                const x = padding + (dataIndex * data.series.length + seriesIndex) * barWidth + barWidth * 0.1;
                                const y = height - padding - ((value - minValue) / (maxValue - minValue)) * chartHeight;
                                const barHeight = ((value - minValue) / (maxValue - minValue)) * chartHeight;
                                
                                ctx.fillRect(x, y, barWidth, barHeight);
                                
                                // Valor sobre a barra
                                ctx.fillStyle = '#333';
                                ctx.font = '12px Arial';
                                ctx.textAlign = 'center';
                                ctx.fillText(value, x + barWidth / 2, y - 5);
                                ctx.fillStyle = colors[seriesIndex % colors.length];
                            });
                        });
                        
                        // R√≥tulos do eixo X
                        ctx.fillStyle = '#666';
                        ctx.font = '12px Arial';
                        ctx.textAlign = 'center';
                        data.categories.forEach((category, index) => {
                            const x = padding + (index + 0.5) * (chartWidth / data.categories.length);
                            ctx.fillText(category, x, height - padding + 20);
                        });
                        
                        // Legenda
                        const legendX = padding;
                        const legendY = padding - 20;
                        data.series.forEach((series, index) => {
                            ctx.fillStyle = colors[index % colors.length];
                            ctx.fillRect(legendX, legendY + (index * 20), 15, 15);
                            ctx.fillStyle = '#333';
                            ctx.textAlign = 'left';
                            ctx.fillText(series.name, legendX + 20, legendY + 12 + (index * 20));
                        });
                        
                    } catch (error) {
                        console.error('Erro no renderChart:', error);
                        throw error;
                    }
                },
                
                generateSampleData: function() {
                    return {
                        series: [
                            { name: 'Produto A', data: [30, 45, 35, 50, 40, 60, 55] },
                            { name: 'Produto B', data: [20, 35, 25, 40, 30, 50, 45] }
                        ],
                        categories: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b', 'Dom']
                    };
                },
                
                handleError: function(container, error) {
                    const containerEl = typeof container === 'string' 
                        ? document.querySelector(container) 
                        : container;
                        
                    if (containerEl) {
                        containerEl.innerHTML = `
                            <div class="chart-error">
                                <p>‚ö†Ô∏è Erro no gr√°fico</p>
                                <small>${error.message}</small>
                            </div>
                        `;
                    }
                },
                
                updateChart: function(chartId, newData) {
                    const chart = this.charts.get(chartId);
                    if (chart) {
                        chart.data = newData;
                        this.renderChart(chart.ctx, chart.canvas.width, chart.canvas.height, newData, chart.options);
                    }
                },
                
                destroyChart: function(chartId) {
                    this.charts.delete(chartId);
                }
            };
            
            // Exposi√ß√£o p√∫blica
            window.scplot = library;
            console.log('‚úÖ scplot.js carregado com sucesso - v' + library.version);
            
            return library;
        })();

        // =============================================
        // app.js - Aplica√ß√£o Principal
        // =============================================
        class MicopelApp {
            constructor() {
                this.currentChart = null;
                this.isInitialized = false;
                this.init();
            }

            init() {
                try {
                    console.log('üöÄ Inicializando Micopel Concorr√™ncia...');
                    
                    // Previne m√∫ltiplas inicializa√ß√µes
                    if (this.isInitialized) {
                        console.warn('‚ö†Ô∏è Aplica√ß√£o j√° inicializada');
                        return;
                    }
                    
                    this.setupEventListeners();
                    this.initializeCharts();
                    this.updateMetrics();
                    this.setupErrorHandling();
                    
                    this.isInitialized = true;
                    this.updateStatus('‚úÖ Aplica√ß√£o Micopel Concorr√™ncia Inicializada com Sucesso!', 'success');
                    
                    console.log('üéâ Micopel Concorr√™ncia totalmente operacional');
                    
                } catch (error) {
                    console.error('üí• Erro cr√≠tico na inicializa√ß√£o:', error);
                    this.updateStatus('‚ùå Erro na inicializa√ß√£o da aplica√ß√£o', 'error');
                }
            }

            setupEventListeners() {
                // Event listeners para bot√µes e intera√ß√µes
                window.addEventListener('resize', () => {
                    this.handleResize();
                });

                // Previne erros de recursos n√£o encontrados
                window.addEventListener('error', (e) => {
                    if (e.target.tagName === 'LINK' || e.target.tagName === 'SCRIPT') {
                        console.warn('‚ö†Ô∏è Recurso n√£o carregado:', e.target.href || e.target.src);
                        e.preventDefault();
                    }
                }, true);
            }

            initializeCharts() {
                try {
                    if (typeof scplot === 'undefined') {
                        throw new Error('Biblioteca scplot n√£o dispon√≠vel');
                    }

                    const chartConfig = {
                        container: '#chart-container',
                        data: this.getChartData('week'),
                        options: {
                            responsive: true,
                            animation: true
                        }
                    };

                    this.currentChart = scplot.createChart(chartConfig);
                    
                    if (!this.currentChart) {
                        throw new Error('Falha ao criar gr√°fico');
                    }
                    
                } catch (error) {
                    console.error('‚ùå Erro na inicializa√ß√£o do gr√°fico:', error);
                    this.handleChartError(error);
                }
            }

            getChartData(timeRange = 'week') {
                const dataSets = {
                    week: {
                        series: [
                            { name: 'Vendas', data: [120, 150, 180, 90, 210, 160, 200] },
                            { name: 'Meta', data: [100, 100, 100, 100, 100, 100, 100] }
                        ],
                        categories: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b', 'Dom']
                    },
                    month: {
                        series: [
                            { name: 'Vendas', data: [1200, 1500, 1800, 900, 2100, 1600, 2000, 1700, 1900, 2200, 1800, 1600] },
                            { name: 'Meta', data: [1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000] }
                        ],
                        categories: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4', 'Sem 5', 'Sem 6', 'Sem 7', 'Sem 8', 'Sem 9', 'Sem 10', 'Sem 11', 'Sem 12']
                    },
                    year: {
                        series: [
                            { name: 'Vendas', data: [12000, 15000, 18000, 9000, 21000, 16000, 20000, 17000, 19000, 22000, 18000, 16000] },
                            { name: 'Meta', data: [10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000] }
                        ],
                        categories: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez']
                    }
                };
                
                return dataSets[timeRange] || dataSets.week;
            }

            updateChart(timeRange) {
                try {
                    console.log(`üîÑ Atualizando gr√°fico para: ${timeRange}`);
                    
                    const newData = this.getChartData(timeRange);
                    
                    if (this.currentChart && scplot) {
                        scplot.updateChart(this.currentChart, newData);
                        this.updateStatus(`üìä Gr√°fico atualizado: ${timeRange}`, 'success');
                    } else {
                        this.initializeCharts();
                    }
                    
                } catch (error) {
                    console.error('‚ùå Erro ao atualizar gr√°fico:', error);
                    this.updateStatus('‚ùå Erro ao atualizar gr√°fico', 'error');
                }
            }

            updateMetrics() {
                // Simula atualiza√ß√£o de m√©tricas em tempo real
                const metrics = [
                    { id: 'metric-1', value: '24.5%' },
                    { id: 'metric-2', value: '15.8%' },
                    { id: 'metric-3', value: '1,247' },
                    { id: 'metric-4', value: '94%' }
                ];
                
                metrics.forEach(metric => {
                    const element = document.getElementById(metric.id);
                    if (element) {
                        element.textContent = metric.value;
                    }
                });
            }

            handleResize() {
                // Debounce para redimensionamento
                clearTimeout(this.resizeTimeout);
                this.resizeTimeout = setTimeout(() => {
                    if (this.currentChart && scplot) {
                        scplot.updateChart(this.currentChart, this.getChartData());
                    }
                }, 250);
            }

            handleChartError(error) {
                const container = document.querySelector('#chart-container');
                if (container) {
                    container.innerHTML = `
                        <div class="chart-error">
                            <p>üìä Gr√°fico Indispon√≠vel</p>
                            <small>Utilizando modo de visualiza√ß√£o alternativa</small>
                            <div style="margin-top: 20px; padding: 20px; background: #f5f5f5; border-radius: 5px;">
                                <strong>Dados da Semana:</strong><br>
                                Vendas: 120, 150, 180, 90, 210, 160, 200<br>
                                Meta: 100, 100, 100, 100, 100, 100, 100
                            </div>
                        </div>
                    `;
                }
            }

            updateStatus(message, type = 'info') {
                const statusElement = document.getElementById('status');
                if (statusElement) {
                    statusElement.textContent = message;
                    statusElement.className = '';
                    
                    switch (type) {
                        case 'success':
                            statusElement.classList.add('status-success');
                            break;
                        case 'warning':
                            statusElement.classList.add('status-warning');
                            break;
                        case 'error':
                            statusElement.classList.add('status-error');
                            break;
                        default:
                            statusElement.style.background = '#e3f2fd';
                            statusElement.style.borderColor = '#2196f3';
                            statusElement.style.color = '#1976d2';
                    }
                }
                
                console.log(`üì¢ Status: ${message}`);
            }

            setupErrorHandling() {
                // Captura global de erros
                window.addEventListener('error', (e) => {
                    console.error('üö® Erro global capturado:', e.error);
                    
                    // Ignora erros de favicon
                    if (e.filename && e.filename.includes('favicon.ico')) {
                        return;
                    }
                    
                    this.updateStatus('‚ö†Ô∏è Erro detectado - sistema operando em modo seguro', 'warning');
                });

                // Captura de promises rejeitadas
                window.addEventListener('unhandledrejection', (e) => {
                    console.error('üö® Promise rejeitada:', e.reason);
                    e.preventDefault();
                });
            }
        }

        // =============================================
        // Inicializa√ß√£o da Aplica√ß√£o
        // =============================================
        let app;

        function initializeApplication() {
            try {
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => {
                        app = new MicopelApp();
                    });
                } else {
                    app = new MicopelApp();
                }
            } catch (error) {
                console.error('üí• Falha cr√≠tica na inicializa√ß√£o:', error);
                document.getElementById('status').textContent = '‚ùå Falha cr√≠tica na aplica√ß√£o';
                document.getElementById('status').className = 'status-error';
            }
        }

        // Inicializa a aplica√ß√£o
        initializeApplication();

        // Exporta para uso global (se necess√°rio)
        window.MicopelApp = MicopelApp;
    </script>
</body>
</html>
